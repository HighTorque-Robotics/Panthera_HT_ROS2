<launch>
  <!-- Gazebo parameters -->
  <arg name="use_sim_time" default="true" />

  <!-- Set Gazebo resource path for meshes -->
  <set_env name="GZ_SIM_RESOURCE_PATH" value="$(find-pkg-share panthera_ht_description_with_finger):$(find-pkg-share panthera_ht_description_with_finger)/.." />

  <!-- Set Gazebo plugin path for ros2_control -->
  <set_env name="GZ_PLUGIN_PATH" value="/opt/ros/jazzy/lib" />

  <!-- URDF path -->
  <let name="urdf_file"
       value="$(find-pkg-share gripper_gazebo)/urdf/Panthera-HT_gazebo.urdf.xacro" />

  <!-- Generate robot_description from xacro -->
  <let name="robot_description_content"
       value="$(command 'xacro $(var urdf_file)')" />

  <!-- Robot State Publisher -->
  <node pkg="robot_state_publisher" exec="robot_state_publisher" output="screen">
    <param name="robot_description" value="$(var robot_description_content)" />
    <param name="use_sim_time" value="$(var use_sim_time)" />
  </node>

  <!-- Start Gazebo -->
  <executable cmd="gz sim -r empty.sdf" output="screen" />

  <!-- Spawn robot -->
  <node pkg="ros_gz_sim" exec="create" output="screen"
        args="-topic robot_description -name panthera_with_gripper">
  </node>

  <!-- Bridge for clock -->
  <node pkg="ros_gz_bridge" exec="parameter_bridge" output="screen"
        args="/clock@rosgraph_msgs/msg/Clock[gz.msgs.Clock">
  </node>

  <!-- Load controllers with delay -->
  <node pkg="controller_manager" exec="spawner"
        args="joint_state_broadcaster --controller-manager-timeout 30"
        output="screen" />

  <node pkg="controller_manager" exec="spawner"
        args="arm_controller --controller-manager-timeout 30"
        output="screen" />

  <node pkg="controller_manager" exec="spawner"
        args="gripper_controller --controller-manager-timeout 30"
        output="screen" />

</launch>
